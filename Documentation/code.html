<html>
<head>
<title>Critical Mass 1.9 Code</title>
</head>
<body bgcolor="#FFFFFF">
<table>
<p align=center>
<font size=5>Code</font><br><br>
</p>
(NB:  Much of the following has been superseded.  See <a href="whatsnew.html">What's New</a> for details.)<br>


<font size=4>Code is now included, for the benefit of those who think it might help them.<br>
<br>I have included sample projects, for use when recompiling.<br>
<br>Please note that you will need the included resource files for sounds and pictures.<br>
<br>If you don't like my commenting habits, too bad. ;-><br>
<br>
<br><b>Basic Comments:</b><br>
<br>Much of the code is written more clumsily than I like.  But then, I didn't have a clear idea how I was going to adapt it to a multi-threaded system.<br>
<br>In particular, if I were to do it again, I would make the brain a separate BLooper, and have it trade messages with the main view for moves.<br>
<br>Basically, there are four areas where multi-threading becomes important:
<ul type=circle>
	<li>Display:  In addition to the regular BLooper handling the events in the window, there is a second thread that handles spacing out the frames of the explosions.  This is handled separately from the events in the window, to permit faster responses to the user.  A set of semaphores and associated flags is used to control when the display thread shows the next set of moves.  No more than one display thread ever exists.
	<li>Thinking:  Once a move has been decided upon, and the display thread started, a new thread is started to think of the computer's next move.  Again, a set of semaphores controls when it starts and finishes, along with the Pulse() function.  This is one of the major reasons that all changes to the game options are delayed until the next turn.
	<li>Multi-threaded thinking:  Bill Kocay thinks by starting up one thread for each row to do the lookahead, then waiting for all the threads to complete.  If the game is interrupted partway through this, the threads may leak memory.  There are, of course, better ways of doing this.
	<li>Sounds are played on separate threads, to permit the rest of the game to continue.
</ul>
<br>Coming from a MacOS background, I wanted to put all the sounds and pictures in a resource file.  Due to the lack of a ResEdit equivalent, I had to hack them in myself.  The code for this is <b>not</b> included, as it involves some quick-and-dirty routines that you <b>really</b> don't want to see.<br>
<br>The board is drawn from a set of bitmaps.  To make life easier for me, the bitmaps are of uniform size (64x64, if I remember correctly), and include the borders for the cells.  Thus, the empty cell is drawn as a bitmap.  This means that I never have to worry about previous contents of cells.<br>
<br><br>
<hr>
<ul>
<li><a href="index.html">Index</a><br>
<li><a href="whatsnew.html">What's New</a><br>
<li><a href="background.html">Background</a><br>
<li><a href="description.html">Description</a><br>
<li><a href="quickstart.html">Quick Start</a><br>
<li><a href="interface.html">Interface</a><br>
<li><a href="game_rules.html">Game Rules</a><br>
<li><a href="strategy.html">Strategy</a><br>
<li><a href="revhist.html">Revision History</a><br>
<li>The Code<br>
<li><a href="credits.html">Credits</a><br>
</ul>
</body>
</html>
